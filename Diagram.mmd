graph TD
    %% External Layer with Azure Icons
    subgraph EXT ["ğŸŒ External Access Layer"]
        USERS["ğŸ‘¥ Internet Users<br/>ğŸ“± Web/Mobile Clients"]
        ADMIN["ğŸ‘¨â€ğŸ’¼ System Administrators<br/>ğŸ”§ DevOps Team"]
        DNS["ğŸŒ Public DNS<br/>ğŸ“ development.vectormind.chat<br/>ğŸ”¢ 9.223.83.214"]
    end

    %% Administrative Cloud Environment
    subgraph AZURE_ADMIN ["â˜ï¸ Microsoft Azure - Administrative Subscription"]
        direction TB
        subgraph ADMIN_RG ["ğŸ¢ rg-vectormind-admin-prod"]
            subgraph ADMIN_VNET ["ğŸ“¡ vnet-admin-prod<br/>ğŸ”¢ Address Space: 10.10.0.0/16<br/>ğŸ“ East US 2"]
                subgraph VPN_GATEWAY ["ğŸ” VPN Gateway Subnet<br/>ğŸ”¢ 10.10.0.0/24"]
                    OPENVPN["ğŸ›¡ï¸ vm-openvpn-prod<br/>âš™ï¸ Standard_B2s (2 vCPU, 4GB)<br/>ğŸ’¾ Premium SSD 64GB<br/>ğŸ”’ Network Security Group"]
                end
                subgraph MGMT_SUBNET ["âš™ï¸ Management Subnet<br/>ğŸ”¢ 10.10.1.0/24"]
                    MGMT_SERVICES["ğŸ“‹ Future: Jump Boxes<br/>ğŸ› ï¸ Admin Tools<br/>ğŸ“Š Monitoring Agents"]
                end
                subgraph BASTION_SUBNET ["ğŸ° AzureBastionSubnet<br/>ğŸ”¢ 10.10.2.0/27"]
                    BASTION_HOST["ğŸ° Azure Bastion<br/>ğŸ”’ Browser-based SSH/RDP<br/>âš¡ Standard SKU"]
                end
            end
        end
    end

    %% Production Application Environment  
    subgraph AZURE_MAIN ["â˜ï¸ Microsoft Azure - Production Subscription"]
        direction TB
        subgraph MAIN_RG ["ğŸ¢ rg-vectormind-app-prod"]
            
            %% Kubernetes Service Section
            subgraph AKS_SECTION ["ğŸš€ Azure Kubernetes Service (AKS)"]
                subgraph MAIN_VNET ["ğŸ“¡ vnet-vectormind-prod<br/>ğŸ”¢ Address Space: 10.0.0.0/16<br/>ğŸ“ East US 2"]
                    subgraph AKS_SUBNET ["âš™ï¸ snet-aks-prod<br/>ğŸ”¢ 10.0.1.0/24<br/>ğŸ”— Delegated to AKS"]
                        subgraph AKS_CLUSTER ["ğŸ¯ aks-vectormind-prod<br/>ğŸ“‹ Kubernetes v1.32<br/>ğŸ” Azure RBAC Enabled<br/>ğŸŒ Azure CNI Network"]
                            
                            subgraph NODE_POOLS ["ğŸ–¥ï¸ Node Pool Configuration"]
                                SYS_NODES["âš™ï¸ System Node Pool<br/>ğŸ“› 'systempool'<br/>ğŸ’¾ Standard_D4s_v3<br/>ğŸ”¢ Min: 1, Max: 3 nodes<br/>ğŸ’¿ OS Disk: 128GB Premium"]
                                APP_NODES["ğŸ–¥ï¸ User Node Pool<br/>ğŸ“› 'apppool'<br/>ğŸ’¾ Standard_D4s_v3<br/>ğŸ”¢ Min: 1, Max: 10 nodes<br/>ğŸ”„ Auto-scaling Enabled"]
                            end
                            
                            subgraph INGRESS_CTRL ["ğŸšª Ingress & Load Balancing"]
                                LOAD_BALANCER["ğŸ”€ Azure Load Balancer<br/>ğŸŒ Public IP: 9.223.83.214<br/>âš¡ Standard SKU"]
                                EMISSARY["ğŸ“¡ Emissary Ingress Controller<br/>ğŸ”€ Layer 7 Load Balancing<br/>ğŸ¯ Path-based Routing"]
                                CERT_MGR["ğŸ” cert-manager<br/>ğŸ” Let's Encrypt Integration<br/>ğŸ”„ Auto SSL Renewal<br/>ğŸ“‹ ClusterIssuer: letsencrypt"]
                            end
                            
                            subgraph APP_WORKLOADS ["ğŸ³ Application Microservices"]
                                AI_SERVICE["ğŸ¤– AI Processing Service<br/>ğŸ§  LLM Request Handler<br/>ğŸ“Š Vector Operations<br/>ğŸ”„ HPA: 2-10 replicas"]
                                VECTOR_DB["ğŸ—‚ï¸ Vector Database<br/>ğŸ” Similarity Search Engine<br/>ğŸ“ˆ Real-time Indexing<br/>ğŸ’¾ Persistent Volume Claims"]
                                DASHBOARD_UI["ğŸ“ˆ Management Dashboard<br/>ğŸ“± React SPA Frontend<br/>ğŸ“Š Analytics Interface<br/>ğŸ” Role-based Access"]
                                AUTH_SERVICE["ğŸ” Authentication Service<br/>ğŸ« JWT Token Management<br/>ğŸ›¡ï¸ OAuth2 Integration<br/>ğŸ“‹ RBAC Enforcement"]
                            end
                            
                            subgraph DATA_TIER ["ğŸ’¾ Data & Caching Layer"]
                                REDIS_CLUSTER["ğŸ”´ Redis Cluster<br/>âš¡ Session Management<br/>ğŸ—„ï¸ Application Cache<br/>ğŸ“Š 6GB Memory Limit<br/>ğŸ”„ 3 Master + 3 Replica"]
                                LANGFUSE_ANALYTICS["ğŸ“Š Langfuse Observability<br/>ğŸ“ˆ LLM Performance Metrics<br/>ğŸ” Request Tracing<br/>ğŸ“‹ Usage Analytics<br/>ğŸ’¾ PostgreSQL Backend"]
                            end
                        end
                    end
                    
                    subgraph DATABASE_SUBNET ["ğŸ—„ï¸ snet-database-prod<br/>ğŸ”¢ 10.0.2.0/24<br/>ğŸ”’ Private Endpoints Only"]
                        POSTGRES_SERVER["ğŸ˜ Azure Database for PostgreSQL<br/>ğŸ“‹ Flexible Server v16<br/>ğŸ’¾ General Purpose D4s_v3<br/>ğŸ’¿ 512GB Premium SSD<br/>ğŸ” Private Endpoint<br/>ğŸ”„ 7-day Backup Retention<br/>ğŸŒ Geo-redundant Backup"]
                    end
                    
                    PRIVATE_DNS_ZONE["ğŸŒ Azure Private DNS Zone<br/>ğŸ“‹ privatelink.postgres.database.azure.com<br/>ğŸ”— VNet Link: Admin + Main VNets"]
                end
            end
            
            %% Serverless Computing
            subgraph SERVERLESS ["âš¡ Azure Functions - Serverless Computing"]
                APP_SERVICE_PLAN["ğŸ“‹ Azure Functions Premium Plan<br/>âš¡ Always On Enabled<br/>ğŸ”¢ EP1: 1 vCPU, 3.5GB RAM<br/>ğŸ”„ Auto-scale: 1-20 instances"]
                
                subgraph FUNCTION_APPS ["ğŸ”§ Function App Collection"]
                    DOC_PROCESSOR["ğŸ“„ func-document-processor<br/>ğŸ” PDF/Word Analysis<br/>ğŸ¤– OCR Integration<br/>â±ï¸ Timeout: 10 minutes"]
                    API_GATEWAY["ğŸ”Œ func-api-gateway<br/>ğŸŒ External API Proxy<br/>ğŸ” Rate Limiting<br/>ğŸ“Š Request Logging"]
                    BACKGROUND_TASKS["â° func-background-tasks<br/>ğŸ”„ Scheduled Jobs<br/>ğŸ“§ Email Processing<br/>ğŸ§¹ Data Cleanup"]
                    NOTIFICATION_HUB["ğŸ“¨ func-notifications<br/>ğŸ’Œ Multi-channel Alerts<br/>ğŸ“± Push Notifications<br/>ğŸ“§ Email Templates"]
                    ANALYTICS_PIPELINE["ğŸ“Š func-analytics-pipeline<br/>ğŸ“ˆ Data Aggregation<br/>ğŸ”„ ETL Operations<br/>ğŸ“‹ Report Generation"]
                    HEALTH_MONITOR["ğŸ‘ï¸ func-health-monitor<br/>ğŸ¥ System Health Checks<br/>ğŸš¨ Alerting Logic<br/>ğŸ“Š Metrics Collection"]
                end
            end
            
            %% Managed Azure Services
            subgraph AZURE_SERVICES ["ğŸ› ï¸ Azure Managed Services"]
                
                subgraph SECURITY_VAULT ["ğŸ” Security & Key Management"]
                    KEY_VAULT["ğŸ—ï¸ Azure Key Vault<br/>ğŸ“› kv-vectormind-prod<br/>ğŸ”’ Secrets, Keys & Certificates<br/>ğŸ” RBAC + Access Policies<br/>ğŸ›¡ï¸ HSM-backed Keys<br/>ğŸ“‹ Audit Logging"]
                end
                
                subgraph AI_COGNITIVE ["ğŸ¤– Azure AI & Cognitive Services"]
                    OPENAI_SERVICE["ğŸ¯ Azure OpenAI Service<br/>ğŸ“› openai-vectormind-prod<br/>ğŸ§  GPT-4o (150K TPM)<br/>ğŸš€ GPT-4o-mini (450K TPM)<br/>ğŸ“œ GPT-3.5-turbo (240K TPM)<br/>ğŸ”’ Private Endpoint<br/>ğŸ“Š Content Safety Enabled"]
                    FORM_RECOGNIZER["ğŸ” Azure AI Document Intelligence<br/>ğŸ“‹ Form Recognizer API<br/>ğŸ“„ Custom Model Training<br/>ğŸ·ï¸ Layout Analysis<br/>ğŸ“Š Table Extraction"]
                end
                
                subgraph STORAGE_ACCOUNTS ["ğŸ’¾ Azure Storage Services"]
                    BLOB_STORAGE["ğŸ—„ï¸ Azure Blob Storage<br/>ğŸ“› stvectormindprod<br/>ğŸ”¥ Hot Tier: Frequently accessed<br/>â„ï¸ Cool Tier: Archived data<br/>ğŸ” Private Endpoints<br/>ğŸ”„ Lifecycle Management"]
                    FILE_STORAGE["ğŸ“ Azure Files<br/>ğŸ’¾ SMB/NFS File Shares<br/>ğŸ”— AKS Persistent Volumes<br/>ğŸ“Š Standard Performance<br/>ğŸ”„ Snapshot Backups"]
                end
                
                subgraph OBSERVABILITY ["ğŸ“Š Monitoring & Observability"]
                    APP_INSIGHTS["ğŸ“ˆ Application Insights<br/>ğŸ“› appi-vectormind-prod<br/>ğŸ” APM & Performance<br/>ğŸ“Š Custom Telemetry<br/>ğŸš¨ Smart Detection<br/>ğŸ“‹ Live Metrics<br/>ğŸ¯ Distributed Tracing"]
                    LOG_ANALYTICS["ğŸ“‹ Log Analytics Workspace<br/>ğŸ“› law-vectormind-prod<br/>ğŸ” Centralized Logging<br/>ğŸ“Š KQL Query Language<br/>ğŸ”„ Data Retention: 90 days<br/>ğŸ“ˆ Custom Dashboards"]
                end
                
                BACKUP_VAULT["ğŸ”„ Recovery Services Vault<br/>ğŸ“› rsv-vectormind-prod<br/>ğŸ’¾ VM & Database Backups<br/>ğŸŒ Geo-redundant Storage<br/>ğŸ”„ 30-day Retention<br/>âš¡ Instant Restore Points"]
            end
            
            subgraph CONFIGURATION ["âš™ï¸ Configuration & Feature Management"]
                APP_CONFIGURATION["ğŸ›ï¸ Azure App Configuration<br/>ğŸ“› appconfig-vectormind-prod<br/>ğŸ“ Feature Flag Management<br/>ğŸ”„ Dynamic Configuration<br/>ğŸ” Managed Identity Access<br/>ğŸ“‹ Configuration Import/Export"]
            end
        end
    end

    %% Enhanced Connection Flows with Professional Styling
    
    %% Public Internet Traffic Flow
    USERS ==>|"ğŸŒ HTTPS/443<br/>ğŸ“± Client Requests"| DNS
    DNS ==>|"ğŸ”€ DNS Resolution<br/>âš¡ Global CDN"| LOAD_BALANCER
    LOAD_BALANCER ==>|"ğŸ¯ Layer 4 LB<br/>ğŸ”’ SSL Termination"| EMISSARY
    
    %% Administrative Access
    ADMIN ==>|"ğŸ” OpenVPN Client<br/>ğŸ›¡ï¸ Encrypted Tunnel"| OPENVPN
    
    %% VNet Peering - Secure Inter-VNet Communication
    ADMIN_VNET <==>|"ğŸ”— VNet Peering<br/>ğŸ”’ Encrypted Transit<br/>ğŸ“¶ No Internet Gateway"| MAIN_VNET
    
    %% Secure Administrative Access Paths
    OPENVPN -.->|"ğŸ” Private Endpoint<br/>ğŸ—„ï¸ Database Admin"| POSTGRES_SERVER
    OPENVPN -.->|"âš™ï¸ kubectl Access<br/>ğŸ¯ K8s Management"| AKS_CLUSTER
    OPENVPN -.->|"ğŸ—ï¸ Secret Management<br/>ğŸ” Key Vault Admin"| KEY_VAULT
    BASTION_HOST -.->|"ğŸ–¥ï¸ SSH/RDP Access<br/>ğŸŒ Browser-based"| OPENVPN
    
    %% Core Application Data Flow
    EMISSARY -->|"ğŸ¯ L7 Routing<br/>ğŸ“‹ Path-based Rules"| APP_WORKLOADS
    APP_WORKLOADS -->|"ğŸ” Private Endpoint<br/>âš¡ Connection Pooling"| POSTGRES_SERVER
    APP_WORKLOADS -->|"ğŸ—ï¸ Managed Identity<br/>ğŸ”’ Secret Retrieval"| KEY_VAULT
    APP_WORKLOADS -->|"ğŸ¤– AI API Calls<br/>ğŸ§  LLM Processing"| OPENAI_SERVICE
    APP_WORKLOADS -->|"ğŸ“„ Document Analysis<br/>ğŸ” Form Processing"| FORM_RECOGNIZER
    
    %% High-Performance Data Layer
    APP_WORKLOADS <-->|"âš¡ Redis Protocol<br/>ğŸ—„ï¸ Session Cache"| REDIS_CLUSTER
    AI_SERVICE -->|"ğŸ“Š Performance Metrics<br/>ğŸ” Request Tracing"| LANGFUSE_ANALYTICS
    APP_WORKLOADS -->|"ğŸ“ˆ Custom Events<br/>ğŸ“Š Business Metrics"| LANGFUSE_ANALYTICS
    
    %% Serverless Integration Layer
    FUNCTION_APPS -->|"ğŸ—„ï¸ Connection Pooling<br/>âš¡ Auto-retry Logic"| POSTGRES_SERVER
    FUNCTION_APPS -->|"ğŸ”‘ Managed Identity<br/>ğŸ—ï¸ Secret Access"| KEY_VAULT
    FUNCTION_APPS -->|"ğŸ’¾ Blob Operations<br/>ğŸ“ File Processing"| BLOB_STORAGE
    FUNCTION_APPS -->|"ğŸ¤– Batch AI Processing<br/>ğŸ“Š Analytics Tasks"| OPENAI_SERVICE
    FUNCTION_APPS -.->|"âš¡ Event Grid<br/>ğŸ”„ Async Triggers"| APP_WORKLOADS
    
    %% Dynamic Configuration Management
    APP_WORKLOADS -.->|"âš™ï¸ Runtime Config<br/>ğŸ›ï¸ Feature Flags"| APP_CONFIGURATION
    FUNCTION_APPS -.->|"ğŸ“ Settings Sync<br/>ğŸ”„ Hot Reload"| APP_CONFIGURATION
    
    %% Comprehensive Observability
    AKS_CLUSTER -->|"ğŸ“Š Container Insights<br/>ğŸ“ˆ Node Metrics"| APP_INSIGHTS
    AKS_CLUSTER -->|"ğŸ“‹ Container Logs<br/>ğŸ” Audit Logs"| LOG_ANALYTICS
    FUNCTION_APPS -->|"âš¡ Function Metrics<br/>ğŸ“Š Execution Stats"| APP_INSIGHTS
    POSTGRES_SERVER -->|"ğŸ—„ï¸ Database Metrics<br/>ğŸ” Query Performance"| LOG_ANALYTICS
    LANGFUSE_ANALYTICS -->|"ğŸ¤– LLM Analytics<br/>ğŸ“ˆ Usage Patterns"| APP_INSIGHTS
    
    %% DNS Resolution & Service Discovery
    PRIVATE_DNS_ZONE -.->|"ğŸŒ Name Resolution<br/>ğŸ” Service Discovery"| POSTGRES_SERVER
    PRIVATE_DNS_ZONE -.->|"ğŸ”— Cross-VNet DNS<br/>ğŸ“¡ Private Zones"| ADMIN_VNET
    
    %% Backup & Disaster Recovery
    POSTGRES_SERVER -->|"ğŸ’¾ Automated Backups<br/>ğŸŒ Geo-redundancy"| BACKUP_VAULT
    BLOB_STORAGE -->|"ğŸ”„ Cross-region Sync<br/>â„ï¸ Archive Tier"| BACKUP_VAULT
    AKS_CLUSTER -->|"ğŸ“¦ Persistent Volumes<br/>ğŸ’¾ Snapshot Backups"| BACKUP_VAULT

    %% Professional Azure Color Scheme
    classDef external fill:#0078d4,stroke:#004578,stroke-width:4px,color:#ffffff,font-weight:bold,font-size:14px
    classDef adminCloud fill:#00bcf2,stroke:#0078d4,stroke-width:3px,color:#000000,font-weight:bold,font-size:13px
    classDef adminResources fill:#40e0d0,stroke:#20b2aa,stroke-width:2px,color:#000000,font-weight:600,font-size:12px
    classDef kubernetes fill:#326ce5,stroke:#1e3a8a,stroke-width:3px,color:#ffffff,font-weight:bold,font-size:13px
    classDef kubernetesNodes fill:#4a90e2,stroke:#2c5aa0,stroke-width:2px,color:#ffffff,font-weight:600,font-size:12px
    classDef database fill:#e74c3c,stroke:#c0392b,stroke-width:3px,color:#ffffff,font-weight:bold,font-size:13px
    classDef serverless fill:#9b59b6,stroke:#8e44ad,stroke-width:3px,color:#ffffff,font-weight:bold,font-size:13px
    classDef azureAI fill:#ff6b35,stroke:#e55100,stroke-width:3px,color:#ffffff,font-weight:bold,font-size:13px
    classDef security fill:#ffa726,stroke:#f57c00,stroke-width:3px,color:#000000,font-weight:bold,font-size:13px
    classDef monitoring fill:#26a69a,stroke:#00695c,stroke-width:3px,color:#ffffff,font-weight:bold,font-size:13px
    classDef storage fill:#78909c,stroke:#455a64,stroke-width:3px,color:#ffffff,font-weight:bold,font-size:13px
    classDef configuration fill:#5e35b1,stroke:#4527a0,stroke-width:3px,color:#ffffff,font-weight:bold,font-size:13px
    classDef networkSecurity fill:#d32f2f,stroke:#b71c1c,stroke-width:2px,color:#ffffff,font-weight:600,font-size:12px

    %% Apply Enhanced Class Styling
    class EXT,USERS,ADMIN,DNS external
    class AZURE_ADMIN adminCloud
    class ADMIN_RG,ADMIN_VNET,VPN_GATEWAY,MGMT_SUBNET,BASTION_SUBNET,OPENVPN,MGMT_SERVICES,BASTION_HOST adminResources
    class AZURE_MAIN,AKS_SECTION,MAIN_VNET,AKS_SUBNET,AKS_CLUSTER kubernetes
    class NODE_POOLS,SYS_NODES,APP_NODES,INGRESS_CTRL,APP_WORKLOADS,DATA_TIER kubernetesNodes
    class DATABASE_SUBNET,POSTGRES_SERVER database
    class SERVERLESS,APP_SERVICE_PLAN,FUNCTION_APPS,DOC_PROCESSOR,API_GATEWAY,BACKGROUND_TASKS,NOTIFICATION_HUB,ANALYTICS_PIPELINE,HEALTH_MONITOR serverless
    class AI_COGNITIVE,OPENAI_SERVICE,FORM_RECOGNIZER azureAI
    class SECURITY_VAULT,KEY_VAULT security
    class OBSERVABILITY,APP_INSIGHTS,LOG_ANALYTICS monitoring
    class STORAGE_ACCOUNTS,BLOB_STORAGE,FILE_STORAGE,BACKUP_VAULT storage
    class CONFIGURATION,APP_CONFIGURATION configuration
    class LOAD_BALANCER,EMISSARY,CERT_MGR,PRIVATE_DNS_ZONE networkSecurity