graph TD
    %% External Users and Access Layer
    subgraph EXT ["🌐 External Access Layer"]
        USERS["👥 Internet Users<br/>📱 Web/Mobile Clients<br/>🧑‍💻 Developers & Admins"]
        DNS["🌍 DNS Resolution<br/>📍 localhost (dev)<br/>🔢 zahara.ai (prod)"]
    end

    %% Development Environment
    subgraph DEV_ENV ["💻 Development Environment"]
        direction TB
        subgraph INFRA_TOOLS ["🔧 Infrastructure Tools"]
            MAKEFILE["📋 Makefile<br/>⚙️ Orchestration<br/>🚀 Build & Deploy<br/>🧪 Testing"]
            DOCKER_COMPOSE["🐳 Docker Compose<br/>📦 Container Orchestration<br/>🔗 Service Networking<br/>💾 Volume Management"]
        end
    end

    %% Docker Container Services
    subgraph SERVICES ["🐳 Containerized Microservices"]
        direction TB

        subgraph WEB_LAYER ["🌐 Web Layer"]
            FRONTEND["📱 React Frontend<br/>⚛️ Vite + TypeScript<br/>🎨 Tailwind CSS + Framer<br/>📊 TanStack Query<br/>🔗 Port: 3001<br/>📍 / - Dashboard"]
        end

        subgraph API_LAYER ["🚀 API Layer"]
            API_SERVICE["🤖 FastAPI Backend<br/>⚡ Python 3.11<br/>🔐 X-API-Key Auth<br/>📡 Observability Middleware<br/>🔗 Port: 8000<br/>📍 /api/* - REST API"]
            ROUTER_SERVICE["🧠 LLM Router<br/>⚡ LiteLLM Integration<br/>🤖 Multi-Provider Support<br/>🔄 Load Balancing<br/>🔗 Port: 7000<br/>📍 /v1/chat/completions"]
        end

        subgraph DATA_LAYER ["💾 Data & Storage Layer"]
            POSTGRES["🐘 PostgreSQL 15<br/>📊 Relational Data<br/>🔄 Alembic Migrations<br/>💾 Traces, Users, API Keys<br/>🔗 Port: 5432"]
            REDIS["🔴 Redis 7<br/>⚡ Session Cache<br/>🗄️ Application Cache<br/>⏱️ Rate Limiting<br/>🔗 Port: 6379"]
            QDRANT["🗂️ Qdrant Vector DB<br/>🔍 Similarity Search<br/>📈 Real-time Indexing<br/>🤖 AI Embeddings<br/>🔗 Port: 6333"]
        end

        subgraph OPTIONAL_SERVICES ["🔧 Optional Services"]
            FLOWISE["🎨 Flowise Workflow<br/>🔄 AI Agent Builder<br/>⚙️ No-Code Interface<br/>🤖 LangChain Integration<br/>🔗 Port: 3000"]
        end
    end

    %% External LLM Providers
    subgraph EXTERNAL_APIS ["🌐 External AI Providers"]
        OPENAI["🎯 OpenAI API<br/>🧠 GPT-4, GPT-3.5-turbo<br/>💰 Token-based Pricing<br/>🔐 API Key Auth"]
        ANTHROPIC["🎭 Anthropic API<br/>🧠 Claude Models<br/>💰 Token-based Pricing<br/>🔐 API Key Auth"]
        GROQ["⚡ Groq API<br/>🧠 Fast Inference<br/>💰 Token-based Pricing<br/>🔐 API Key Auth"]
        OPENROUTER["🔀 OpenRouter API<br/>🌐 Multi-Provider Router<br/>💰 Unified Pricing<br/>🔐 API Key Auth"]
    end

    %% Connection Flows

    %% User Access Flow
    USERS ==>|"🌐 HTTP/HTTPS<br/>📱 Web Requests"| DNS
    DNS -->|"🔗 Local Development<br/>📍 localhost:3001"| FRONTEND
    DNS -.->|"🔗 Production<br/>📍 zahara.ai"| FRONTEND

    %% Frontend to Backend Flow
    FRONTEND -->|"🔐 X-API-Key Auth<br/>📡 REST API Calls<br/>📊 Real-time Polling"| API_SERVICE
    FRONTEND -.->|"🔄 Optional Webhook<br/>📊 Evaluation Data"| FLOWISE

    %% API Service Data Flow
    API_SERVICE -->|"💾 CRUD Operations<br/>🔄 Transaction Logs"| POSTGRES
    API_SERVICE -->|"⚡ Session Cache<br/>🗄️ Query Results"| REDIS
    API_SERVICE -->|"🔍 Vector Search<br/>📈 Similarity Queries"| QDRANT
    API_SERVICE -.->|"🎨 Workflow Triggers<br/>📊 Evaluation Metrics"| FLOWISE

    %% Router Service Flow
    API_SERVICE -->|"🤖 LLM Requests<br/>🔄 Provider Routing"| ROUTER_SERVICE
    ROUTER_SERVICE -->|"🎯 OpenAI Models"| OPENAI
    ROUTER_SERVICE -->|"🎭 Claude Models"| ANTHROPIC
    ROUTER_SERVICE -->|"⚡ Groq Models"| GROQ
    ROUTER_SERVICE -->|"🔀 Multi-Provider"| OPENROUTER

    %% Development Tools Flow
    MAKEFILE -->|"📋 Orchestration<br/>🚀 Service Management"| DOCKER_COMPOSE
    DOCKER_COMPOSE -->|"🐳 Container Management<br/>🔗 Network Setup"| SERVICES
    MAKEFILE -.->|"🧪 Test Execution<br/>🔍 Health Checks"| SERVICES

    %% Database Relationships
    API_SERVICE -.->|"📊 Observability Data<br/>🔍 Request Tracing"| POSTGRES
    FLOWISE -.->|"📈 Evaluation Metrics<br/>📊 Performance Data"| POSTGRES

    %% Professional Color Scheme for Zahara.ai
    classDef external fill:#0078d4,stroke:#004578,stroke-width:4px,color:#ffffff,font-weight:bold,font-size:14px
    classDef development fill:#00bcf2,stroke:#0078d4,stroke-width:3px,color:#000000,font-weight:bold,font-size:13px
    classDef services fill:#326ce5,stroke:#1e3a8a,stroke-width:3px,color:#ffffff,font-weight:bold,font-size:13px
    classDef webLayer fill:#ff6b35,stroke:#e55100,stroke-width:2px,color:#ffffff,font-weight:600,font-size:12px
    classDef apiLayer fill:#9b59b6,stroke:#8e44ad,stroke-width:2px,color:#ffffff,font-weight:600,font-size:12px
    classDef dataLayer fill:#e74c3c,stroke:#c0392b,stroke-width:2px,color:#ffffff,font-weight:600,font-size:12px
    classDef optional fill:#78909c,stroke:#455a64,stroke-width:2px,color:#ffffff,font-weight:600,font-size:12px
    classDef externalAPIs fill:#26a69a,stroke:#00695c,stroke-width:3px,color:#ffffff,font-weight:bold,font-size:13px
    classDef infrastructure fill:#ffa726,stroke:#f57c00,stroke-width:2px,color:#000000,font-weight:600,font-size:12px

    %% Apply Class Styling
    class EXT,USERS,DNS external
    class DEV_ENV,INFRA_TOOLS development
    class SERVICES services
    class WEB_LAYER,FRONTEND webLayer
    class API_LAYER,API_SERVICE,ROUTER_SERVICE apiLayer
    class DATA_LAYER,POSTGRES,REDIS,QDRANT dataLayer
    class OPTIONAL_SERVICES,FLOWISE optional
    class EXTERNAL_APIS,OPENAI,ANTHROPIC,GROQ,OPENROUTER externalAPIs
    class MAKEFILE,DOCKER_COMPOSE infrastructure